<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <title>Projeto Integrador - Automação Aquaponia</title>
    <style>
        html {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            color: #2980b9;
        }

        .form-group {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            gap: 10px;
        }

        .form-group input[type="password"],
        .form-group input[type="date"] {
            padding: 10px;
            font-size: 14px;
            border: 2px solid #9b59b6;
            border-radius: 5px;
        }

        .form-group input[type="checkbox"] {
            margin-left: 5px;
        }

        .buttonON, .buttonOFF {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
            border: none;
        }

        .buttonON {
            background-color: #4CAF50;
            color: white;
        }

        .buttonOFF {
            background-color: #e74c3c;
            color: white;
        }

        .apply-button {
            background-color: #C0C0C0;
            color: #2c3e50;
            font-size: 16px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #chart-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }

        canvas {
            width: 100%;
        }

        .analysis {
            margin-top: 20px;
            text-align: left;
            width: 80%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <h1>PROJETO INTEGRADOR - UNIVESP</h1>

    <div class="form-group">
        <label>API Key:</label>
        <input type="password" id="ts-api-key" value="BY3NQR5RTECHYXQ5">
        <input type="checkbox" onclick="toggleVisibility('ts-api-key')"> Exibir
    </div>

    <div class="form-group">
        <label>Channel ID:</label>
        <input type="password" id="ts-channel-id" value="2533413">
        <input type="checkbox" onclick="toggleVisibility('ts-channel-id')"> Exibir
    </div>

    <div class="form-group">
        <button class="buttonON">Ligar Bomba</button>
        <button class="buttonOFF">Desligar Bomba</button>
    </div>

    <div class="form-group">
        <button class="buttonON">Ligar Aquecedor</button>
        <button class="buttonOFF">Desligar Aquecedor</button>
    </div>

    <div class="form-group">
        <label>Início:</label>
        <input type="date" id="startDate">
        <label>Fim:</label>
        <input type="date" id="endDate">
    </div>

    <button class="apply-button" onclick="applyFilter()">Aplicar Filtro</button>

    <h2>Temperatura:</h2>
    <div id="chart-container">
        <canvas id="temperatureChart"></canvas>
    </div>

    <div class="analysis">
        <h3>Análise:</h3>
        <p id="in-range">Dentro do Range (26°C - 28°C): <b>0 horas</b></p>
        <p id="above-max">Acima da Máxima (28°C): <b>0 horas</b></p>
        <p id="below-min">Abaixo da Mínima (26°C): <b>0 horas</b></p>
    </div>

    <script>
        function toggleVisibility(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        async function loadTemperatureData() {
            const response = await fetch('feeds.csv');
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            return rows.map(row => {
                const [timestamp, , , , temp] = row.split(',');
                return {
                    timestamp: new Date(timestamp),
                    temperature: parseFloat(temp)
                };
            }).filter(entry => !isNaN(entry.temperature));
        }

        async function applyFilter() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const data = await loadTemperatureData();
            const filteredData = data.filter(entry => entry.timestamp >= startDate && entry.timestamp <= endDate);

            const hoursInRange = filteredData.filter(entry => entry.temperature >= 26 && entry.temperature <= 28).length / 60;
            const hoursAboveMax = filteredData.filter(entry => entry.temperature > 28).length / 60;
            const hoursBelowMin = filteredData.filter(entry => entry.temperature < 26).length / 60;

            document.getElementById('in-range').innerHTML = `Dentro do Range (26°C - 28°C): <b>${hoursInRange.toFixed(2)} horas</b>`;
            document.getElementById('above-max').innerHTML = `Acima da Máxima (28°C): <b>${hoursAboveMax.toFixed(2)} horas</b>`;
            document.getElementById('below-min').innerHTML = `Abaixo da Mínima (26°C): <b>${hoursBelowMin.toFixed(2)} horas</b>`;

            createChart(filteredData);
        }

        function createChart(data) {
            const ctx = document.getElementById('temperatureChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(entry => entry.timestamp.toLocaleTimeString()),
                    datasets: [{
                        label: 'Temperatura',
                        data: data.map(entry => entry.temperature),
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Hora do Dia' } },
                        y: { title: { display: true, text: 'Temperatura (°C)' }, min: 20, max: 30 }
                    }
                }
            });
        }

        loadTemperatureData().then(createChart);
    </script>
</body>
</html>

